# Use Ubuntu as the base image
FROM ubuntu:latest

# Avoid prompts from apt during build
ARG DEBIAN_FRONTEND=noninteractive

# Install necessary packages
RUN apt-get update -y \
    && apt-get install -y wget curl gnupg software-properties-common lsb-release sudo

# Add the Adoptium repository and install Temurin JDK 17
RUN wget -O /etc/apt/keyrings/adoptium.asc https://packages.adoptium.net/artifactory/api/gpg/key/public \
    && echo "deb [signed-by=/etc/apt/keyrings/adoptium.asc] https://packages.adoptium.net/artifactory/deb $(lsb_release -sc) main" | tee /etc/apt/sources.list.d/adoptium.list \
    && apt-get update -y \
    && apt-get install -y temurin-17-jdk

# Install Jenkins
RUN curl -fsSL https://pkg.jenkins.io/debian-stable/jenkins.io.key | tee /usr/share/keyrings/jenkins-keyring.asc > /dev/null \
    && echo "deb [signed-by=/usr/share/keyrings/jenkins-keyring.asc] https://pkg.jenkins.io/debian-stable binary/" | tee /etc/apt/sources.list.d/jenkins.list > /dev/null \
    && apt-get update -y \
    && apt-get install -y jenkins

# Check for Jenkins WAR location and prepare for execution
RUN find / -name "jenkins.war"

# Expose default Jenkins port
EXPOSE 8080

# Correct path to Jenkins WAR based on installation
CMD ["java", "-jar", "/usr/share/jenkins/jenkins.war"]

